AWSTemplateFormatVersion: "2010-09-09"

Description: "RDS MySQL Instance"

Parameters:
  DBNAME:
    Type: String
    Description: "Database name"
  
  DBUSERNAME:
    Type: String
    Description: "Database master username"
    NoEcho: true
  
  DBPASSWORD:
    Type: String
    Description: "Database master password"
    NoEcho: true
  
  DBINSTANCE:
    Type: String
    Description: "DB Instance Identifier"
    NoEcho: true
  
  SUBNETZONE:
    Type: String
    Description: "Subnet Availability Zone"
    NoEcho: true
  
  VPCID:
    Type: AWS::EC2::SecurityGroup
    Description: "The ID of the VPC"
  
Resources:
  MySqlDBInstance:
    Type: "AWS::RDS::DBInstance"
    Properties:
      DBInstanceIdentifier: !Ref "DBINSTANCE"
      AvailabilityZone: !Ref "SUBNETZONE"
      AllocatedStorage: "20"
      DBInstanceClass: "db.t3.micro"
      Engine: "mysql"
      EngineVersion: "8.0.35"
      MasterUsername: !Ref "DBUSERNAME"
      MasterUserPassword: !Ref "DBPASSWORD"
      DBName: !Ref "DBNAME"
      StorageType: "gp2"
      PubliclyAccessible: false
      BackupRetentionPeriod: 1
      AutoMinorVersionUpgrade: true
      VPCSecurityGroups: 
        - !Ref "VPCID"

Outputs:
  MySqlDBEndpoint:
    Description: "MySQL DB endpoint"
    Value: !GetAtt MySqlDBInstance.Endpoint.Address
  MySqlDBPort:
    Description: "MySQL DB port"
    Value: !GetAtt MySqlDBInstance.Endpoint.Port
